# PushPro: مكتبة ذاتية الاستضافة لتطبيقات الويب التقدمية (PWA) وإشعارات الويب

مكتبة خفيفة الوزن تركز على الخصوصية لتحويل أي موقع ويب إلى تطبيق ويب تقدمي (PWA) مع إمكانيات إشعارات دفع كاملة. تعمل بالكامل على الخادم الخاص بك باستخدام PHP و SQLite.

## الميزات

*   **بدون تبعيات:** لا تتطلب خدمات خارجية مثل OneSignal أو Firebase.
*   **ملكية كاملة:** أنت تملك بيانات المشتركين الخاصة بك (المخزنة محليًا في SQLite).
*   **تطبيق ويب تقدمي فوري:** يضيف وظيفة "تثبيت التطبيق" إلى موقعك.
*   **لوحة تحكم للمسؤول:** واجهة عصرية بوضع داكن لإدارة الحملات.
*   **تخزين ذكي مؤقت:** استراتيجيات "الشبكة أولاً" للدعم في حالة عدم الاتصال بالإنترنت.

## المتطلبات الأساسية

*   PHP 8.1 أو أعلى
*   Composer مثبت
*   شهادة SSL (بروتوكول HTTPS مطلوب لـ Service Workers)
*   تمكين إضافة SQLite

## التثبيت

### 1. إعداد الملفات

قم برفع مجلد `push` إلى الخادم الخاص بك. بعد ذلك، انقل ملفات `sw.js` و `manifest.json` و `icon.png` إلى المجلد الجذر لموقعك (بجانب `index.html` أو `index.php`).

يجب أن يبدو الهيكل الخاص بك كما يلي:

```
/public_html
├── index.html
├── sw.js
├── manifest.json
├── icon.png
└── push/
    ├── admin.php
    ├── api.php
    ├── composer.json
    └── ...
```

### 2. تثبيت التبعيات

انتقل إلى مجلد `push` عبر الطرفية (terminal) وقم بتشغيل Composer لتثبيت مكتبات التشفير المطلوبة.

```bash
cd push
composer install
```

### 3. تعيين الأذونات

تأكد من أن الخادم يمكنه الكتابة في مجلد `push` لإنشاء قاعدة البيانات.

```bash
chmod 755 push
```

### 4. تهيئة النظام

افتح متصفحك وقم بزيارة صفحة التثبيت لإنشاء حساب المسؤول الخاص بك وتوليد مفاتيح VAPID.

`https://your-domain.com/push/install.php`

## التكامل

أضف الأسطر التالية إلى قسم `<head>` في ملف موقعك الرئيسي (على سبيل المثال، `index.html` ).

```html
<link rel="manifest" href="/manifest.json">
<script src="/push/client.js" defer></script>
<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js');
    }
</script>
```

## الإعدادات

### هوية التطبيق

قم بتحرير ملف `manifest.json` في المجلد الجذر لتغيير اسم التطبيق ولون المظهر.

```json
{
  "name": "My App",
  "short_name": "App",
  "start_url": "/index.html",
  "display": "standalone",
  "background_color": "#000000",
  "theme_color": "#000000",
  "icons": [
    {
      "src": "/icon.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icon.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
```

### تحديث المحتوى

لفرض تحديث لجميع المستخدمين (إبطال ذاكرة التخزين المؤقت)، قم بتغيير الثابت `CACHE_VERSION` في الجزء العلوي من ملف `sw.js`.

```javascript
const CACHE_VERSION = 'v1.1';
```

## الاستخدام

*   **الاشتراك:** قم بزيارة موقعك. ستظهر مطالبة الاشتراك تلقائيًا.
*   **إرسال الإشعارات:**
    *   اذهب إلى `https://your-domain.com/push/`
    *   سجل الدخول باستخدام بيانات الاعتماد الخاصة بك.
    *   اكتب رسالتك.
    *   اكتب `SEND` للتأكيد والإرسال.

## استكشاف الأخطاء وإصلاحها

*   **الإشعار لا يظهر؟**
    تأكد من أنك تستخدم HTTPS. لا يعمل Service Workers على HTTP.
*   **خطأ في قاعدة البيانات؟**
    تحقق من أذونات المجلد. يجب أن يكون مجلد `push` قابلاً للكتابة بواسطة عملية PHP.
*   **شاشة بيضاء؟**
    تأكد من أنك قمت بتشغيل `composer install` داخل مجلد `push`.
